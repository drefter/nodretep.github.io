<html>
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link href="http://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
  <link href="lafay.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<style type="text/css">

</style>

<script>

var restPeriod = 3;

var workout = [
    {
        id: "refoflafay",
        name: "dips",
        sets: 6,
        repetitions: 5,
        rest: restPeriod,
        next: 25
    },
    {
        id: "refoflafay",
        name: "chair pressups",
        sets: 6,
        repetitions: 6,
        rest: restPeriod,
        next: 25
    },
    {
        id: "refoflafay",
        name: "raised feet, wide arm pressups",
        sets: 6,
        repetitions: 6,
        rest: restPeriod,
        next: 180
    },
    {
        id: "refoflafay",
        name: "pull ups",
        sets: 6,
        repetitions: 5,
        rest: restPeriod,
        next: 180
    },
    {
        id: "refoflafay",
        name: "door hang squats (right)",
        sets: 6,
        repetitions: 5,
        rest: restPeriod,
        next: 180
    }
    ,
    {
        id: "refoflafay",
        name: "door hang squats (left)",
        sets: 6,
        repetitions: 5,
        rest: restPeriod,
        next: 180
    },
    {
        id: "refoflafay",
        name: "jump squats",
        sets: 6,
        repetitions: 5,
        rest: restPeriod,
        next: 180
    },
    {
        id: "refoflafay",
        name: "sit ups",
        sets: 6,
        repetitions: 10,
        rest: restPeriod,
        next: 180
    },
    {
        id: "refoflafay",
        name: "hanging knee raise",
        sets: 6,
        repetitions: 1,
        rest: restPeriod,
        next: 90
    },
    {
        id: "refoflafay",
        name: "wall press",
        sets: 4,
        repetitions: 15,
        rest: 25,
        next: 0
    }
];

var currentRoutine = {
    routineCount: 0,
    routine: {},
    set: 0,
};

var inRest = false;

var interval;

/*
Starts the whole thing off.
*/
function doWorkout(){
    document.getElementById("finishedSetButton").classList.remove("hiddenButton");
    currentRoutine.routine = workout[currentRoutine.routineCount];
    currentRoutine.set = currentRoutine.set + 1;
    doRoutine();
}

/*

*/
function finishedSet(){
    //check here if we are on the last one.
    if(inRest){
        // move the user to the next routine.
        if(interval){
            clearInterval(interval);
            inRest = false;
            document.getElementById('timerDiv').innerHTML = "00:00";
            currentRoutine.set = currentRoutine.set + 1;
            doRoutine();            
        }
    }else if(currentRoutine.set === currentRoutine.routine.sets){
        currentRoutine.set = currentRoutine.set + 1;
        doRoutine();
    }else{
        startTimer(currentRoutine.routine.rest, document.getElementById('timerDiv'));
    }
}

/*

*/
function doRoutine(){
    //if the set is the set then ... rest and change
    if(currentRoutine.set <= currentRoutine.routine.sets){
        document.getElementById('excerciseDiv').innerHTML = 
            currentRoutine.routine.name + " for " + currentRoutine.routine.repetitions + " reps ";

        document.getElementById('setsDiv').innerHTML = 
             + currentRoutine.set + " of " + currentRoutine.routine.sets + " sets";
    }else{
        var restPeriod = currentRoutine.routine.next;
        currentRoutine.routineCount += 1;
        if(currentRoutine.routineCount === workout.length){
            document.getElementById('excerciseDiv').innerHTML = "its done you can collapse";
        }
        currentRoutine.routine = workout[currentRoutine.routineCount];
        currentRoutine.set = 0;
        startTimer(restPeriod, document.getElementById('timerDiv'));
        document.getElementById('excerciseDiv').innerHTML = " rest before the next set!!";
        inRest = true;
    }
}

/*
- need an easy start stop in order to be able to click fast.
-
*/
function startTimer(duration, display) {
    var timer = duration, minutes, seconds;
    interval = setInterval(function () {
        document.getElementById("finishedSetButton").disabled = true;
        minutes = parseInt(timer / 60, 10);
        seconds = parseInt(timer % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        display.textContent = minutes + ":" + seconds;

        if (--timer < 0) {
            clearInterval(interval);//timer = duration;//resets the timer.
            currentRoutine.set = currentRoutine.set + 1;
            document.getElementById("finishedSetButton").disabled = false;
            doRoutine();
        }
    }, 1000);
}

window.onload = function () {
    /*var fiveMinutes = 25,
        display = document.querySelector('#time');
    startTimer(fiveMinutes, display);*/

   // doWorkout(workout);
};


</script>
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand" href="#">Lafay Timer</a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li>
        <li><a onclick="doWorkout();" data-toggle="collapse" data-target="#myNavbar">Start Level 2</a></li>
        <li><a href="#">Level 3 and more todo</a></li>
        <li><a href="#">Page 3</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container-fluid">
    <div class="jumbotron">
        <div class="container">
            <div class="row">
                <div class="col-sm-12" id="excerciseDiv"></div>
            </div>
            <div class="row">
                <div class="col-sm-12" id="setsDiv"></div>
            </div>
            <div class="row">
                <div  class="col-sm-12" id="timerDiv">00:00</div>
            </div>
        </div>
    </div>

    <div class="row">
            <div class="col-sm-12">
                <button id="finishedSetButton" class="btn btn-primary btn-lg btn-block" onclick="finishedSet();">Done</button>
            </div>
    </div>

</div>

</body>
</html>